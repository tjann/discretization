---
title: "Case Study: Graphical Comparison of Raw and Booleanized Data"
author: "Tiffany Jann"
date: ""
output: 
  html_document:
    fig_height: 3
    fig_width: 5
---
<!-- Don't edit in between this line and the one below -->
```{r include=FALSE}
# Don't delete this chunk if you are using the DataComputing package
library(DataComputing)
```
*Source file* 
```{r, results='asis', echo=FALSE}
includeSourceDocuments()
```


<!-- Don't edit the material above this line -->
```{r}
options(scipen=999)
```

Variable inputs:
```{r}
#Determine how many points you want to look at
alpha <- 10
#Gold Standard Network
goldFile <- "ADHD_Sub010fmri.csv"
#Discretized Results
method <- "ADHD_Sub010_mean.csv"
```

Helper: reads and transposes data table
```{r}
read.tcsv = function(file, header=TRUE, sep=",", ...) {

  n = max(count.fields(file, sep=sep), na.rm=TRUE)
  x = readLines(file)

  .splitvar = function(x, sep, n) {
    var = unlist(strsplit(x, split=sep))
    length(var) = n
    return(var)
  }

  x = do.call(cbind, lapply(x, .splitvar, sep=sep, n=n))
  x = apply(x, 1, paste, collapse=sep) 
  out = read.csv(text=x, sep=sep, header=header)
  return(out)

}
```

Load and normalize original network
```{r}
raw <- read.tcsv(goldFile, header=T)[1:alpha,]
raw <- na.omit(raw)
head(raw)
# raw %>% ggplot(aes(x = ))

#Vertical shift
print(min(raw))
raw <- raw - min(raw)
#Should be 0
print(min(raw))

#Scaling to unit length
raw <- raw / (max(raw) - min(raw))

#Normalized original
head(raw)
print(min(raw))
print(max(raw))

#Vectors for each node of original
v1 <- raw[[1]]
```

Load a discretization output
```{r}
discretized <- read.tcsv(method, header=TRUE)[1:alpha,]
head(discretized)
rownames <- discretized[,1]
discretized <- na.omit(discretized[,-1])
head(discretized)
```

Create a plottable data frame with all necessary information
```{r}
time <- c(1:nrow(raw))
raw <- v1
binary <- discretized[[1]]
time
raw
binary
dfraw <- data.frame(time, raw)
dfbin <- data.frame(time, binary)

df <- data.frame(time, raw, binary)
df <- df %>% gather(datatype, value, c(raw, binary))
```

Plot data frame
```{r}
df %>% ggplot(aes(x = time, y = value, group=1)) + facet_wrap(~ datatype) + geom_point() + geom_line() + geom_area()
```

Overlay plot
```{r}
df %>% ggplot(aes(x = time, y = value)) + geom_point(aes(color=datatype)) + geom_line(data=dfraw, aes(x=time, y=raw), color="blue") + geom_line(data=dfbin, aes(x=time, y=binary), color="red") + geom_area(data=dfraw, aes(x=time, y=raw), alpha=0.5, fill="blue") + geom_area(data=dfbin, aes(x=time, y=binary), alpha=0.5, fill="red") + geom_vline(xintercept = seq(1, alpha, by=1), alpha=0.4) + ylim(0, 1) + xlim(0,alpha)
``` 


Using integration to find difference in areas for each time interval
```{r}

binaryArea <- sum(binary[2:(length(raw) - 1)]) + (binary[1] + binary[length(raw)]) / 2

rawArea <- sum(raw[2:(length(raw) - 1)]) + (raw[1] + raw[length(raw)]) / 2
```

Compare areas
```{r}
binaryArea
rawArea
```