---
title: "Case Study: Graphical Comparison of Raw and Booleanized Data"
author: ""
date: ""
output: 
  html_document:
    fig_height: 3
    fig_width: 5
---
<!-- Don't edit in between this line and the one below -->
```{r include=FALSE}
# Don't delete this chunk if you are using the DataComputing package
library(DataComputing)
library(flux)
```
*Source file* 
```{r, results='asis', echo=FALSE}
includeSourceDocuments()
```
<!-- Don't edit the material above this line -->
```{r}
options(scipen=999)
```

Variable inputs:
```{r}
#Determine how many points you want to look at
alpha <- 90
#Gold Standard Network
goldFile <- "wk2fivefmriCS100S20N3000.csv"
#Discretized Results
method <- "wk2five_mean.csv"
```

Helper: reads and transposes data table
```{r}
read.tcsv = function(file, header=TRUE, sep=",", ...) {

  n = max(count.fields(file, sep=sep), na.rm=TRUE)
  x = readLines(file)

  .splitvar = function(x, sep, n) {
    var = unlist(strsplit(x, split=sep))
    length(var) = n
    return(var)
  }

  x = do.call(cbind, lapply(x, .splitvar, sep=sep, n=n))
  x = apply(x, 1, paste, collapse=sep) 
  out = read.csv(text=x, sep=sep, header=header)
  return(out)

}
```

Load and normalize original network
```{r}
raw <- read.tcsv(goldFile, header=FALSE)[1:alpha,]
raw <- na.omit(raw)
head(raw)

#Vertical shift
print(min(raw))
raw <- raw - min(raw)
#Should be 0
print(min(raw))

#Scaling to unit length
raw <- raw / (max(raw) - min(raw))

#Normalized original
head(raw)
print(min(raw))
print(max(raw))

#Vectors for each node of original
v1 <- raw$V1
v2 <- raw$V2
v3 <- raw$V3
v4 <- raw$V4
v5 <- raw$V5
```

Load a discretization output
```{r}
discretized <- read.tcsv(method, header=TRUE)[1:alpha,]
rownames <- discretized[,1]
discretized <- na.omit(discretized[,-1])
head(discretized)
```

Create a plottable data frame with all necessary information
```{r}
time <- c(1:nrow(raw))
raw <- v1
binary <- discretized$Gene1
df <- data.frame(time, raw, binary)
df <- df %>% gather(datatype, value, c(raw, binary))
```

Plot data frame
```{r}
df %>% ggplot(aes(x = time, y = value, group=1)) + facet_wrap(~ datatype) + geom_point() + geom_line() + geom_area()
```

Overlay plot
```{r}
df %>% ggplot(aes(x = time, y = value)) + geom_point(aes(color=datatype))
```


Using *exact* trapezoid rule to find area
```{r}
binaryArea <- sum(binary[2:(length(raw) - 1)]) + (binary[1] + binary[length(raw)]) / 2

rawArea <- sum(raw[2:(length(raw) - 1)]) + (raw[1] + raw[length(raw)]) / 2
```

Compare areas
```{r}
binaryArea
rawArea
```





<!-- Find all applicable files w.r.t. gold standard network -->
<!-- ```{r} -->
<!-- #Assuming we are only using data generated by MULAN -->
<!-- pattern <- gsub("fmri.*\\.csv$", "", goldFile) -->

<!-- allfiles <- list.files(getwd(), pattern) -->
<!-- allfiles -->
<!-- ``` -->

<!-- Helper: gets all discretization results ready for evaluation -->
<!-- ```{r} -->
<!-- getfile <- function(file){ -->
<!--   discretized <- read.tcsv(file) -->
<!--   discretized <- na.omit(discretized) -->
<!--   rownames <- discretized[,1] -->
<!--   discretized <- discretized[,-1] -->
<!--   #Ensures data uses 0 1 instead of 1 2 -->
<!--   if(max(discretized) != 1){ -->
<!--     discretized <- discretized - max(discretized) + 1 -->
<!--   } -->
<!--   head(discretized) -->
<!-- } -->
<!-- ``` -->

<!-- Load all files using helper `getfile` -->
<!-- ```{r} -->
<!-- disc <- sapply(allfiles, getfile) -->
<!-- ``` -->


<!-- Helper: calculates score for a discretization result -->
<!-- ```{r} -->
<!-- score <- function(discretized){ -->
<!--   x1 <- discretized$Gene1 -->
<!--   x2 <- discretized$Gene2 -->
<!--   x3 <- discretized$Gene3 -->
<!--   x4 <- discretized$Gene4 -->
<!--   x5 <- discretized$Gene5 -->
<!--   totdiff <- sum(abs(x1 - v1), abs(x2 - v2), abs(x3 - v3), abs(x4 - v4), abs(x5 - v5)) -->
<!--   return(totdiff) -->
<!-- } -->
<!-- ``` -->

<!-- Apply all `disc` files to helper `score` -->
<!-- ```{r} -->
<!-- scores <- sapply(disc, score) -->
<!-- ``` -->

<!-- View results -->
<!-- ```{r} -->
<!-- sort(scores, decreasing = TRUE) -->
<!-- ``` -->