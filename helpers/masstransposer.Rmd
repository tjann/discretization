---
title: "Transpose Multiple Spreadsheets"
author: "Tiffany Jann"
date: ""
output: 
  html_document:
    fig_height: 3
    fig_width: 5
---
<!-- Don't edit in between this line and the one below -->
```{r include=FALSE}
# Don't delete this chunk if you are using the DataComputing package
library(DataComputing)
```
*Source file* 
```{r, results='asis', echo=FALSE}
includeSourceDocuments("/Users/jann/github/discretization/masstransposer.Rmd")
```
<!-- Don't edit the material above this line -->
```{r include=FALSE}
options(scipen=999)
```

Helper: reads and transposes data table
```{r}
#Note: default header=TRUE, which is the case when brain regions are specified
read.tcsv = function(file, header=TRUE, sep=",", ...) {

  n = max(count.fields(file, sep=sep), na.rm=TRUE)
  x = readLines(file)

  .splitvar = function(x, sep, n) {
    var = unlist(strsplit(x, split=sep))
    length(var) = n
    return(var)
  }

  x = do.call(cbind, lapply(x, .splitvar, sep=sep, n=n))
  x = apply(x, 1, paste, collapse=sep) 
  out = read.csv(text=x, sep=sep, header=header, check.names = FALSE)
  return(out)

}
```

Find all spreadsheet files
```{r}
#Assuming we are only using data generated by MULAN
allfiles <- list.files(getwd(), ".csv$")
allfiles
```

Helper: gets all files ready for use
```{r}
getfile <- function(file){
  transposed <- read.tcsv(file)
  write.table(transposed, file, sep = ",", col.names = T, row.names = F, qmethod = "double")
}
```

Load all files into vectors using helper `getfile`
```{r}
sapply(allfiles, getfile)
```
